<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>UPP: FDLVL.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">UPP
   &#160;<span id="projectnumber">001</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('FDLVL_8f.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">FDLVL.f File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Subroutine that computes T, Q, U, V on the flight levels (FD).  
<a href="#details">More...</a></p>

<p><a href="FDLVL_8f_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ac1dedeeda1cfd828301f619da3880cbb"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac1dedeeda1cfd828301f619da3880cbb"></a>
subroutine&#160;</td><td class="memItemRight" valign="bottom"><b>FDLVL</b> (ITYPE, TFD, QFD, UFD, VFD, PFD, ICINGFD, AERFD)</td></tr>
<tr class="separator:ac1dedeeda1cfd828301f619da3880cbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50d7ed4613cc246037b302a2387841b1"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FDLVL_8f.html#a50d7ed4613cc246037b302a2387841b1">FDLVL_MASS</a> (ITYPE, NFD, PTFD, HTFD, NIN, QIN, QTYPE, QFD)</td></tr>
<tr class="memdesc:a50d7ed4613cc246037b302a2387841b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes FD level for mass variables.  <a href="#a50d7ed4613cc246037b302a2387841b1">More...</a><br/></td></tr>
<tr class="separator:a50d7ed4613cc246037b302a2387841b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad19b75c33450267785e72e6f1f8dc4e3"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FDLVL_8f.html#ad19b75c33450267785e72e6f1f8dc4e3">FDLVL_UV</a> (ITYPE, NFD, HTFD, UFD, VFD)</td></tr>
<tr class="memdesc:ad19b75c33450267785e72e6f1f8dc4e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes FD level for u,v.  <a href="#ad19b75c33450267785e72e6f1f8dc4e3">More...</a><br/></td></tr>
<tr class="separator:ad19b75c33450267785e72e6f1f8dc4e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Subroutine that computes T, Q, U, V on the flight levels (FD). </p>
<p>This routine computes temperature, spec. hum, u wind component, and v wind component on the NFD=6 FD levels. The height of these levels (in meters) is given in the data statement below. The alogrithm proceeds as follows. (AGL-Above ground level in parentheses)</p>
<p>At each mass point move up vertically from the LM-TH (lowest atmospheric) ETA layer. Find the ETA layers whose height (above ground) bounds the target FD level height. Vertically interpolate to get temperature at this FD level. Average the four surrounding winds to get a mass point wind. Vertically interpolate these mass point winds to the target FD level. Continue this process until all NFD=6 FD levels have been processed. Move on to the next mass point.</p>
<p>Averaging the four above ground winds to the mass point was found to smooth the field and reduce the occurrence of point peak winds far in excess of the winds at adjacent points. Mass point values are returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ITYPE</td><td>Flag that determines whether MSL (1) or AGL (2) Levels are used. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">TFD</td><td>Temperature (K) on FD levels. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">QFD</td><td>Spec hum on FD levels. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">UFD</td><td>U wind (m/s) on FD levels. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">VFD</td><td>V wind (m/s) on FD levels.</td></tr>
  </table>
  </dd>
</dl>
<h3>Program History Log</h3>
<table class="doxtable">
<tr>
<th>Date </th><th>Programmer </th><th>Comments  </th></tr>
<tr>
<td>1992-12-22 </td><td>Russ Treadon </td><td>Initial </td></tr>
<tr>
<td>1993-11-23 </td><td>Russ Treadon </td><td>Corrected routine to compute FD levels with respect to mean sea level </td></tr>
<tr>
<td>1994-01-04 </td><td>Mike Baldwin </td><td>Include options for computing either AGL or MSL </td></tr>
<tr>
<td>1998-06-15 </td><td>T Black </td><td>Conversion from 1-D to 2-D </td></tr>
<tr>
<td>2000-01-04 </td><td>Jim Tuccillo </td><td>MPI version </td></tr>
<tr>
<td>2002-01-15 </td><td>Mike Baldwin </td><td>WRF version </td></tr>
<tr>
<td>2011-12-14 </td><td>Sarah Lu </td><td>Add GOCART aerosol AERFD </td></tr>
</table>
<dl class="section author"><dt>Author</dt><dd>Russ Treadon W/NP2 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>1992-12-22 </dd></dl>

<p>Definition in file <a class="el" href="FDLVL_8f_source.html">FDLVL.f</a>.</p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a class="anchor" id="a50d7ed4613cc246037b302a2387841b1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine FDLVL_MASS </td>
          <td>(</td>
          <td class="paramtype">integer, dimension(nfd), intent(in)&#160;</td>
          <td class="paramname"><em>ITYPE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>NFD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nfd), intent(in)&#160;</td>
          <td class="paramname"><em>PTFD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nfd), intent(in)&#160;</td>
          <td class="paramname"><em>HTFD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>NIN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(im,jsta:jend,lm,nin), intent(in)&#160;</td>
          <td class="paramname"><em>QIN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character, dimension(nin), intent(in)&#160;</td>
          <td class="paramname"><em>QTYPE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(im,jsta:jend,nfd,nin), intent(out)&#160;</td>
          <td class="paramname"><em>QFD</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes FD level for mass variables. </p>
<p>This routine computes mass variables (temperature, spec. hum...) on NFD FD levels. The height of these levels (in meters) is passed as an input parameter. The alogrithm proceeds as follows. (AGL-Above ground level in parentheses)</p>
<p>At each mass point move up vertically from the LM-TH (lowest atmospheric) ETA layer. Find the ETA layers whose height (above ground) bounds the target FD level height. Vertically interpolate to get temperature at this FD level. Average the four surrounding winds to get a mass point wind. Vertically interpolate these mass point winds to the target FD level. Continue this process until all NFD FD levels have been processed. Move on to the next mass point.</p>
<p>Averaging the four above ground winds to the mass point was found to smooth the field and reduce the occurrence of point peak winds far in excess of the winds at adjacent points. Mass point values are returned.</p>
<p>NOTES for Q fields by Y Mao: The following safety check should be executed by the caller of FDLVL subroutines. Safety check to avoid tiny QFD values. KRF: Need NCAR and NMM WRF cores in this check as well? </p>
<div class="fragment"><div class="line">IF(MODELNAME==<span class="stringliteral">&#39;RAPR&#39;</span> .OR. MODELNAME==<span class="stringliteral">&#39;NCAR&#39;</span> .OR. MODELNAME==<span class="stringliteral">&#39;NMM&#39;</span>) THEN   !</div>
<div class="line">  DO IFD = 1,NFD</div>
<div class="line">    DO J=JSTA,JEND</div>
<div class="line">    DO I=1,IM</div>
<div class="line">       if(QFD(I,J,IFD) &lt; 1.0e-8) QFD(I,J,IFD)=0.0</div>
<div class="line">    ENDDO</div>
<div class="line">    ENDDO</div>
<div class="line">  ENDDO</div>
<div class="line">endif</div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ITYPE</td><td>Flag that determines whether MSL (1) or AGL (2) Levels are used. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">NFD</td><td>Number of FD levels. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">PTFD</td><td>FD pressure levels. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">HTFD</td><td>FD height levels. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">NIN</td><td>Number of input fields. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">QIN</td><td>Array of mass point value on model levels. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">QTYPE</td><td>Charater array of variable type to differentiate underground interpolation. <pre>
                   C-5 Cloud Species
                   K-TURBULENT KINETIC ENERGY
                   Q-Specific Humidity
                   T-Temperature, 
                   W-Vertical Velocity or Omega
</pre> </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">QFD</td><td>Array of mass point value on FD levels.</td></tr>
  </table>
  </dd>
</dl>
<h3>Program History Log</h3>
<table class="doxtable">
<tr>
<th>Date </th><th>Programmer </th><th>Comments  </th></tr>
<tr>
<td>1992-12-22 </td><td>Russ Treadon </td><td>Initial </td></tr>
<tr>
<td>1993-11-23 </td><td>Russ Treadon </td><td>Corrected routine to compute FD levels with respect to mean sea level </td></tr>
<tr>
<td>1994-01-04 </td><td>Mike Baldwin </td><td>Include options for computing either AGL or MSL </td></tr>
<tr>
<td>1998-06-15 </td><td>T Black </td><td>Conversion from 1-D to 2-D </td></tr>
<tr>
<td>2000-01-04 </td><td>Jim Tuccillo </td><td>MPI version </td></tr>
<tr>
<td>2002-01-15 </td><td>Mike Baldwin </td><td>WRF version </td></tr>
<tr>
<td>2011-12-14 </td><td>Sarah Lu </td><td>Add GOCART aerosol AERFD </td></tr>
<tr>
<td>2017-06-01 </td><td>Y Mao </td><td>Add FD levels for GTG(EDPARM CATEDR MWTURB) and allow levels input from control file </td></tr>
<tr>
<td>2019-09-25 </td><td>Y Mao </td><td>Seperate mass from UV allow array of mass input to interpolate multiple fields with the same levels at one time. Dust=&gt; AERFD can be processed when NIN=NBIN_DU </td></tr>
<tr>
<td>2020-11-10 </td><td>Jesse Meng </td><td>Use UPP_PHYSICS module </td></tr>
</table>
<dl class="section author"><dt>Author</dt><dd>Russ Treadon W/NP2 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>1992-12-22 </dd></dl>

<p>Definition at line <a class="el" href="FDLVL_8f_source.html#l00815">815</a> of file <a class="el" href="FDLVL_8f_source.html">FDLVL.f</a>.</p>

<p>References <a class="el" href="UPP__PHYSICS_8f_source.html#l00341">upp_physics::fpvsnew()</a>.</p>

</div>
</div>
<a class="anchor" id="ad19b75c33450267785e72e6f1f8dc4e3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine FDLVL_UV </td>
          <td>(</td>
          <td class="paramtype">integer, dimension(nfd), intent(in)&#160;</td>
          <td class="paramname"><em>ITYPE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>NFD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nfd), intent(in)&#160;</td>
          <td class="paramname"><em>HTFD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(im,jsta_2l:jend_2u,nfd), intent(out)&#160;</td>
          <td class="paramname"><em>UFD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(im,jsta_2l:jend_2u,nfd), intent(out)&#160;</td>
          <td class="paramname"><em>VFD</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes FD level for u,v. </p>
<p>This routine computes u/v wind component on NFD FD levels. The height of these levels (in meters) is passed as an input parameter. The alogrithm proceeds as follows. (AGL-Above ground level in parentheses)</p>
<p>At each mass point move up vertically from the LM-TH (lowest atmospheric) ETA layer. Find the ETA layers whose height (above ground) bounds the target FD level height. Vertically interpolate to get temperature at this FD level. Average the four surrounding winds to get a mass point wind. Vertically interpolate these mass point winds to the target FD level. Continue this process until all NFD FD levels have been processed. Move on to the next mass point.</p>
<p>Averaging the four above ground winds to the mass point was found to smooth the field and reduce the occurrence of point peak winds far in excess of the winds at adjacent points. Mass point values are returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ITYPE</td><td>Flag that determines whether MSL (1) or AGL (2) Levels are used. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">NFD</td><td>Number of FD levels. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">HTFD</td><td>FD levels. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">UFD</td><td>U wind (m/s) on FD levels. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">VFD</td><td>V wind (m/s) on FD levels.</td></tr>
  </table>
  </dd>
</dl>
<h3>Program History Log</h3>
<table class="doxtable">
<tr>
<th>Date </th><th>Programmer </th><th>Comments  </th></tr>
<tr>
<td>1992-12-22 </td><td>Russ Treadon </td><td>Initial </td></tr>
<tr>
<td>1993-11-23 </td><td>Russ Treadon </td><td>Corrected routine to compute FD levels with respect to mean sea level </td></tr>
<tr>
<td>1994-01-04 </td><td>Mike Baldwin </td><td>Include options for computing either AGL or MSL </td></tr>
<tr>
<td>1998-06-15 </td><td>T Black </td><td>Conversion from 1-D to 2-D </td></tr>
<tr>
<td>2000-01-04 </td><td>Jim Tuccillo </td><td>MPI version </td></tr>
<tr>
<td>2002-01-15 </td><td>Mike Baldwin </td><td>WRF version </td></tr>
<tr>
<td>2011-12-14 </td><td>Sarah Lu </td><td>Add GOCART aerosol AERFD </td></tr>
<tr>
<td>2019-09-25 </td><td>Y Mao </td><td>Seperate U/V from mass </td></tr>
</table>
<dl class="section author"><dt>Author</dt><dd>Russ Treadon W/NP2 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>1992-12-22 </dd></dl>

<p>Definition at line <a class="el" href="FDLVL_8f_source.html#l00486">486</a> of file <a class="el" href="FDLVL_8f_source.html">FDLVL.f</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d8b772108138bf796aaa3f7fe4e09294.html">sorc</a></li><li class="navelem"><a class="el" href="dir_29f0049402def9fd0d109199f2d306c2.html">ncep_post.fd</a></li><li class="navelem"><a class="el" href="FDLVL_8f.html">FDLVL.f</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
